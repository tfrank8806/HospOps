@page
@model HospOps.Pages.PassOn.IndexModel
@{
    ViewData["Title"] = "Pass On";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <a class="btn btn-outline-secondary"
       asp-page-handler="PrevDay"
       asp-route-date="@Model.Day.ToString("yyyy-MM-dd")">← Previous Day</a>

    <strong>@Model.Day.ToString("dddd, MMM d, yyyy")</strong>

    <a class="btn btn-outline-secondary"
       asp-page-handler="NextDay"
       asp-route-date="@Model.Day.ToString("yyyy-MM-dd")">Next Day →</a>
</div>

<form method="get" class="row gy-2 gx-2 align-items-end mb-3">
    <div class="col-auto">
        <label class="form-label">Date</label>
        <input class="form-control" type="date" name="date" value="@Model.Day.ToString("yyyy-MM-dd")" />
    </div>
    <div class="col-auto">
        <button class="btn btn-primary" type="submit">Go</button>
    </div>
</form>

<div class="card mb-4">
  <div class="card-header">Add Pass On Note</div>
  <div class="card-body">
    <form method="post" asp-page-handler="Add" class="row g-3">
      <div class="col-md-2">
        <label class="form-label">Department</label>
        <select class="form-select" asp-for="Note.Department">
@foreach (var v in Enum.GetValues(typeof(HospOps.Models.Department)))
{
    <option value="@((int)v)">@v</option>
}
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Title</label>
        <input class="form-control" asp-for="Note.Title" />
      </div>
      <div class="col-md-6">
        <label class="form-label">Message</label>
        <input class="form-control" asp-for="Note.Message" />
      </div>
      <div class="col-12">
        <button class="btn btn-success" type="submit">Add</button>
      </div>
    </form>
  </div>
</div>

<table class="table table-striped table-hover align-middle">
  <thead>
    <tr>
      <th style="width:8rem">Time</th>
      <th style="width:10rem">Department</th>
      <th style="width:20rem">Title</th>
      <th>Message</th>
      <th style="width:12rem">Actions</th>
    </tr>
  </thead>
  <tbody>
@foreach (var n in Model.Notes)
{
    <tr>
      <td>@n.CreatedAt.ToLocalTime().ToString("hh:mm tt")</td>
      <td>@n.Department</td>
      <td>@n.Title</td>
      <td>
        <div class="small text-muted">@n.Message</div>
        @if (n.UpdatedAt.HasValue)
        {
            <div class="small text-muted">edited @n.UpdatedAt.Value.ToLocalTime().ToString("g")</div>
        }
      </td>
      <td class="text-end">
        <form method="post" asp-page-handler="Edit" class="d-inline">
            <input type="hidden" name="id" value="@n.Id" />
            <input type="hidden" name="Note.Department" value="@((int)n.Department)" />
            <input type="hidden" name="Note.Title" value="@n.Title" />
            <input type="hidden" name="Note.Message" value="@n.Message" />
            <button class="btn btn-sm btn-outline-secondary" type="submit">Save</button>
        </form>
        @if (User.IsInRole("Admin"))
        {
          <form method="post" asp-page-handler="Delete" asp-route-id="@n.Id" class="d-inline">
            <button class="btn btn-sm btn-outline-danger" type="submit" onclick="return confirm('Delete this note?');">Delete</button>
          </form>
        }
      </td>
    </tr>
}
  </tbody>
</table>
