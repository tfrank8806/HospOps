@page
@model HospOps.Pages.Admin.AccessRequests.IndexModel
@{
    ViewData["Title"] = "Access Requests";
}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="m-0">Pending Access Requests</h4>
    <a class="btn btn-outline-secondary" asp-page="/Admin/Tools/Migrations">Apply Migrations</a>
</div>

@if (TempData["Err"] is string err)
{
    <div class="alert alert-warning">@err</div>
}
@if (TempData["Msg"] is string msg)
{
    <div class="alert alert-success">@msg</div>
}

@if (Model.Pending.Count == 0)
{
    <div class="text-muted">No pending requests.</div>
}
else
{
<table class="table table-striped table-hover align-middle">
  <thead>
    <tr>
      <th>Name</th>
      <th>Email</th>
      <th>Mobile</th>
      <th>Property Code</th>
      <th>Requested</th>
      <th style="width:14rem"></th>
    </tr>
  </thead>
  <tbody>
@foreach (var r in Model.Pending)
{
    <tr>
      <td>@r.FirstName @r.LastName</td>
      <td>@r.Email</td>
      <td>@(string.IsNullOrWhiteSpace(r.MobilePhone) ? "-" : r.MobilePhone)</td>
      <td>@r.PropertyCode</td>
      <td>@r.CreatedAt.ToLocalTime().ToString("g")</td>
      <td class="text-end">
        <form method="post" asp-page-handler="Approve" asp-route-id="@r.Id" class="d-inline">
            <button class="btn btn-sm btn-success" type="submit">Approve</button>
        </form>
        <form method="post" asp-page-handler="Reject" asp-route-id="@r.Id" class="d-inline" onsubmit="return confirm('Reject this request?');">
            <button class="btn btn-sm btn-outline-danger" type="submit">Reject</button>
        </form>
      </td>
    </tr>
}
  </tbody>
</table>
}
